!function(e,t){"use strict";angular.module("adf.widget.getphd",["adf.provider","llp.extract","fa.droppable","llp.parsetsv","roar","textSizeSlider","llp.pdf","LocalStorageModule","llp.extractpdf","firebase","ui.router","commonServices","xeditable","ui.utils","ui.tree","ngAnimate","ngAnnotateText","ngDialog","ngSanitize","pdf","phd","toastr","mentio","lionlawlabs","ui","diff","door3.css","checklist-model","authentication","angular-md5","angular.filter","admin","roarmap","ngFileUpload"]).config(["dashboardProvider","localStorageServiceProvider",function(e,t){t.setPrefix("adf.getphd"),e.widget("column",{title:"ColumnHeader",description:"Define groupings of widgets",templateUrl:"{widgetsPath}/getphd/src/titleTemplate.html",icon:"fa-ge",iconurl:"img/lexlab.svg",styleClass:"warning panel panel-warning",frameless:!0}).widget("getphd",{title:"+PhD",description:"import a patent prosecution history",templateUrl:"{widgetsPath}/getphd/src/view.html",controller:"MainCtrl",controllerAs:"main",frameless:!0,reload:!0,collapsed:!0,icon:"fa-ge",iconurl:"img/logolong.png",styleClass:"primary panel panel-primary",edit:{templateUrl:"{widgetsPath}/getphd/src/edit.html",controller:"MainCtrl",controllerAs:"main",modalSize:"lg",reload:!0,immediate:!0},resolve:{config:["config","$firebaseArray","$rootScope","FIREBASE_URL",function(e,t,a,n){if(e.id)return e;var i=t(new Firebase(n+"content/"));return i.$add({name:"curation"}).then(function(t){var a=t.key();return t.update({id:a,ispublished:!1,content_type:"curation",timestamp:Firebase.ServerValue.TIMESTAMP}),e.id=a,e}),e}]}})}]).constant("FIREBASE_URL","https://lexlab.firebaseio.com/").controller("MainCtrl",["Collection","extract","fileReader","$http","parseTSV","$roarmap","$q","$scope","config","PHD","localStorageService","extractpdf","pdfToPlainText","$log",function(e,t,a,n,i,l,r,o,s,c,d,p,f,u){var g=this;g.size="lg",s.id||(s.id=""),g.config=s,o.definition=o.$parent.definition;var h=s.id,m=e(h);m.$bindTo(o,"phd"),o.configured=function(){return""!==o.config.appnum},o.notConfigured=function(){return""===o.config.appnum};var b={header:!0};g.phd={};s.appnum;g.parse=function(e){var t=r.defer();return angular.forEach(e,function(e,a){try{}catch(n){u.error(n)}finally{return"imagefile"===e.label?o.phd.imagefile=i(e.file,b):"application"===e.label?o.phd.application=i(e.file):"attorney"===e.label?o.phd.attorney=i(e.file):"foreign"===e.label?o.phd.foreign=i(e.file,b,!1):"continuity"===e.label?o.phd.continuity=i(e.file,b,!1):"transaction"===e.label?o.phd.transaction=i(e.file,b,!1):"README"===e.label?g.info=e.file:g.error="Unhandled case!",t.resolve(o.phd)}}),t.promise},g.getfilehistory=function(e){g.spinner=!0,g.progress=0;var e=e,a="http://127.0.0.1:8080/",i="http://storage.googleapis.com/uspto-pair/applications/"+e+".zip",l={method:"GET",url:a+i,headers:{"Target-Endpoint":i}};n(l).then(function(a){g.file=a.data,console.log(a.data),t(a.data,e).then(function(e){console.log(e),g.file=e,g.parse(e).then(function(){g.spinner=!1})},function(e){g.error=e.message})})},g.remotezip=function(e){n.get("http://storage.googleapis.com/uspto-pair/applications/"+e+".zip",function(e,t){e&&(g.error=e);var a=new JSZip(t);g.handleFiles(a)})},g.success=null,g.info=null,g.handleFiles=function(e){g.error=null,g.success=null,p(e.files[0]).then(function(e){u.info("Files extracted",e),o.phd.file=e.tsvfiles,g.parse(e.tsvfiles).then(function(e){u.info("TSV Parsed",e),l(e,o.phd).then(function(e){o.phd.roarmap=e,d.set(s.appnum,o.phd)},function(e){g.error=e.message})},function(e){g.error=e.messsage})},function(e){g.error=e.message})},g.getFile=function(){g.progress=0,a.readAsDataUrl(g.file,g).then(function(e){g.handleFiles(e),g.imageSrc=e})},o.$on("fileProgress",function(e,t){g.progress=t.loaded/t.total}),g.pdFF=function(e){var t=r.defer();return angular.forEach(e,function(e,a){return e&&e.name.indexOf(".pdf")>-1?(f(e).then(function(e){o.phd.file.push(e)}),t.resolve(pdf)):t.reject("not a pdf")}),t.promise}}]).directive("ffFileSelect",[function(){return{restrict:"A",controller:"MainCtrl",controllerAs:"main",bindToController:!0,scope:!1,link:function(e,t,a,n){var i=n;t.on("change",function(e){i.file=(e.srcElement||e.target).files[0],i.getFile()})}}}]),angular.module("adf.widget.getphd").run(["$templateCache",function(e){e.put("{widgetsPath}/getphd/src/edit.html",'<form role=form><div class=form-group><label for=sample>Application #</label> <input type=text class=form-control id=sample ng-model=config.appnum placeholder="Enter Application #"></div></form>'),e.put("{widgetsPath}/getphd/src/titleTemplate.html",'<div class=panel-heading><button class="fa fa-close fa-2x btn-danger button-outline pull-right floatingclosebutton round" onclick=$(this).parent().parent().remove();></button><h4 class=bs-callout style=color:white;>{{config.title || $parent.config.title}} <span class=pull-right><a title=notes ng-click="console.log(\'note\')"><i class="fa fa-pencil" style=color:white;></i></a> <a title=mail ng-click=$publish(this)><i class="fa fa-send" style=color:white;></i></a> <a title=comment ng-click="console.log(\'note\')"><i class="fa fa-comments-o" style=color:white;></i></a> <a title="reload widget content" ng-click=reload()><i class="fa fa-refresh" style=color:white;></i></a> <a title="change widget location" class=adf-move><i class="glyphicon glyphicon-move" style=color:white;></i></a> <a title="collapse widget" ng-show="options.collapsible && !widgetState.isCollapsed" ng-click="widgetState.isCollapsed = !widgetState.isCollapsed"><i class="glyphicon glyphicon-minus" style=color:white;></i></a> <a title="expand widget" ng-show="options.collapsible && widgetState.isCollapsed" ng-click="widgetState.isCollapsed = !widgetState.isCollapsed"><i class="glyphicon glyphicon-plus" style=color:white;></i></a> <a title="edit widget configuration" ng-click=edit()><i class="glyphicon glyphicon-cog" style=color:white;></i></a> <a title="fullscreen widget" ng-click=openFullScreen() ng-show="options.maximizable || true"><i class="glyphicon glyphicon-fullscreen" style=color:white;></i></a> <a title="remove widget" ng-click=remove() ng-if=editMode><i class="glyphicon glyphicon-remove" style=color:white;></i></a></span></h4></div>'),e.put("{widgetsPath}/getphd/src/view.html",'<div class="card card-primary card-block btn-glass drop-target" drop-files=handleFiles(files) style="border: 2px dashed blue;margin: 5px;"><button class="row btn btn-glass btn-primary img img-rounded" ng-hide=phd.file style=position:relative;display:flex;display:-webkit-flex;align-items:center;align-content:center;justify-content:space-around;flex-direction:row; ng-click=main.remotezip(config.appnum)><i class="fa fa-download fa-3x">{{config.appnum}}</i> <img src=https://lexlab.firebaseapp.com/img/GoldLogoLong.svg class="pop img img-rounded pull-right" ng-if=!config.appnum></button><div class=row ng-hide=phd.file><div class="alert alert-danger" role=alert ng-if=main.error><strong>Uh oh!</strong> {{main.error}}</div><pre class="alert alert-info" role=alert ng-if=main.info style="color:white !important;">{{main.info}}</pre></div></div><div class=card style="text-align: left;color: #444;" ng-if=phd.file><tabset><tab class=ngDialogTab><tab-heading>{{phd.application[0][1]}}</tab-heading><tabset><tab ng-repeat="file in phd.file" heading="{{file.label | uppercase}}"><pre class="card card-block card-fancy" ng-bind=file.file></pre></tab></tabset></tab><tab class="ngDialogTab primary" ng-if=phd.application><tab-heading style=color:white>APPLICATION</tab-heading><hr><table class="card card-default card-block table table-striped table-hover table-condensed table-responsive"><tbody><tr ng-repeat="line in phd.application"><td ng-repeat="value in line">{{value}}</td></tr></tbody></table></tab><tab class="ngDialogTab info" ng-if=phd.attorney><tab-heading>ATTORNEY</tab-heading><table class="card card-default card-block table table-striped table-hover table-condensed table-responsive"><tbody><tr ng-repeat="line in phd.attorney"><td ng-repeat="value in line">{{value}}</td></tr></tbody></table></tab><tab class="ngDialogTab success" ng-if=phd.continuity><tab-heading style=color:white;>CONTINUITY</tab-heading><table class="card card-default card-block table table-striped table-condensed table-hover table-responsive"><thead><tr><th ng-repeat="field in phd.continuity.meta.fields">{{field}}</th></tr></thead><tbody><tr ng-repeat="line in phd.continuity.data"><td ng-repeat="value in line">{{value}}</td></tr></tbody></table></tab><tab class="ngDialogTab warning" ng-if=phd.foreign><tab-heading style=color:white>FOREIGN PRIORITY</tab-heading><table class="card card-default card-block table table-striped table-condensed table-hover table-responsive"><thead><tr><th>Country</th><th>Priority</th><th>Priority Date</th></tr></thead><tbody><tr ng-repeat="p in phd.foreign"><td ng-bind="p[\'Country\']"></td><td ng-bind="p[\'Priority\']"></td><td ng-bind="p[\'Priority Date\'] | date"></td></tr></tbody></table></tab><tab class="ngDialogTab danger" ng-if=phd.transaction><tab-heading style=color:white;>TRANSACTION</tab-heading><table class="card card-default card-block table table-striped table-hover table-condensed table-responsive"><thead><tr><th>Date</th><th>Transaction Description</th></tr></thead><tbody><tr ng-repeat="trans in phd.transaction"><td>{{trans[\'Date\']}}</td><td>{{trans[\'Transaction Description\']}}</td></tr></tbody></table></tab><tab class=ngDialogTab ng-if=phd.imagefile><tab-heading>IMAGE FILE WRAPPER</tab-heading><input type=text ng-model=main.query placeholder=search... class=pull-right><table class="card card-default card-block table table-hover table-condensed table-responsive"><thead><tr><th ng-click="reverse = !reverse" class=fa ng-class="{\'fa-chevron-up\': reverse,\'fa-chevron-down\': !reverse}">#</th><th>Mail Room Date</th><th>Document Code</th><th>Document Description</th><th>Document Category</th><th>Page Count</th><th>Filename</th></tr></thead><tbody><tr ng-repeat="roarevent in phd.imagefile |filter: main.query" class="card card-{{roarevent.styleClass}}"><th><a ng-click="pdfToPlainText(roarevent[\'Filename\'])" getpdftext><i class="fa fa-link">{{$index}}</i></a></th><td ng-bind="roarevent[\'Mail Room Date\']"></td><td ng-bind="roarevent[\'Document Code\']"></td><td ng-bind="roarevent[\'Document Description\']"></td><td ng-bind="roarevent[\'Document Category\']"></td><td ng-bind="roarevent[\'Page Count\']"></td><td ng-bind="roarevent[\'Filename\']"></td></tr></tbody></table></tab><tab class="ngDialogTab {{collection.styleClass}}" ng-repeat="collection in phd.roarmap.collections" collection={{collection}}><tab-heading style=color:white;>{{collection.rid}}</tab-heading><div style="width: 100%;" class=reventlist><roar-event ng-repeat="event in collection.roarlist" id={{event}} style=width:19.5%;></roar-event></div></tab><tab class=ngDialogTab><tab-heading>ROAR <label class="label label-info label-pill">{{phd.imagefile.length}}</label></tab-heading><div style="width: 100%;min-height: 500px;" class=reventlist><roar-event roarevent=roarevent class=info editable=true dir-paginate="roarevent in phd.roarmap.roarevents | filter: roarId | filter: query |filter: issueId | orderBy: [(sortorder || \'date\'),\'sortIndex\',\'rid\',\'name\'] : dctn | itemsPerPage: 20" pagination-id=roarmappagination ng-animate-ref="{{ roarevent.$id }}" id={{roarevent}}></roar-event></div></tab><tab class=ngDialogTab ng-if=phd.pdffiles><tab-heading>PDFs <label class="label label-pill label-info">{{phd.pdffiles.length}}</label></tab-heading><tabset><tab ng-repeat="pdf in phd.pdffiles"><tab-heading>{{pdf.name}}</tab-heading><section class=card id=pdf ng-controller=PDFfilecontroller></section></tab></tabset></tab></tabset></div>')}]),angular.module("textSizeSlider",[]).directive("textSizeSlider",["$document",function(e){return{restrict:"E",template:'<div class="text-size-slider"><span class="small-letter" ng-style="{ fontSize: min + unit }">A</span> <input type="range" min="{{ min }}" max="{{ max }}" step="{{ step || 0 }}" ng-model="textSize" class="slider" value="{{ value }}" /> <span class="big-letter" ng-style="{ fontSize: max + unit }">A</span></div>',scope:{min:"@",max:"@",unit:"@",value:"@",step:"@"},link:function(t,a,n){t.textSize=t.value,t.$watch("textSize",function(a){e[0].style.fontSize=a+t.unit,$("html").style("font-size",a+t.unit)})}}}]),angular.module("roar",[]).factory("$mocks",[function(){var e={groupId:"0000x0000",matterId:"0000x0000",pId:"0000x0000",roarId:"0000x0000"};return e}]).factory("$roarevent",["OWNERSHIPDOCS","ARTDOCS","MERITSDOCS","DOCNAMES","PETDOCCODES","NOADOCCODES","INTVDOCCODES","PTODOCCODES","APPDOCCODES","$q",function(e,t,a,n,i,l,r,o,s,c){return function(e){function t(e){var t=angular.copy(e),c=e.Filename||e.name||e.filename,d=c.slice(0,c.indexOf("-")),p=c.slice(c.indexOf("-")+1,c.indexOf("-")+11),f=c.slice(c.lastIndexOf("-")+1,c.indexOf(".pdf"));t.content_type="document",e.url&&(t.media=e.url,t.uuid=e.id,t.mimeType=e.mimeType||null),t.description=e["Document Description"]||null,t.filename=e.Filename||e.name||e.filename,t.collections=[],t.application=d||null,t.date=p||null,t.doccode=e["Document Code"]||f,angular.forEach(s,function(e,a){f===e&&(t.styleClass="Applicant")}),angular.forEach(o,function(e,a){f===e&&(t.styleClass="PTO")}),angular.forEach(r,function(e,a){f===e&&(t.styleClass="Interview")}),angular.forEach(l,function(e,a){f===e&&(t.styleClass="NOA")}),angular.forEach(i,function(e,a){f===e&&(t.styleClass="Petition")}),angular.forEach(n,function(e,a){angular.forEach(e,function(e,a){f===a&&(t.name=e,t.title=e)})});var u=(new Date,new Date),g=u.getTime();return t.dashboard={model:{rows:[{columns:[{cid:g+10,styleClass:"col-sm-6",widgets:[{config:{height:"30em",url:t.media||"http://www.google.com"},title:t.title||"title",titleTemplateUrl:"{widgetsPath}/testwidget/src/title.html",type:"iframe",wid:g+100,styleClass:t.styleClass||"btn-dark"}]},{cid:g+1e3,styleClass:"col-sm-6",widgets:[{config:{draftid:"PROMISE"},title:t.title||"title",titleTemplateUrl:"{widgetsPath}/testwidget/src/title.html",type:"testwidget",wid:g+15,styleClass:t.styleClass||"btn-dark"}]}]}],structure:"ROAR-DEFAULT",title:t.title||"PROMISE",titleTemplateUrl:"../src/templates/dashboard-title.html"}},a.resolve(t)}var a=c.defer();return t(e),a.promise}}]).factory("$roarmap",["$stateParams","Matter","Collection","ROARevent","ROARevents","Collections","$mocks","$timeout","OWNERSHIPDOCS","ARTDOCS","MERITSDOCS","DOCNAMES","PETDOCCODES","NOADOCCODES","INTVDOCCODES","PTODOCCODES","APPDOCCODES","$q","PHD","$log","FIREBASE_URL",function(e,t,a,n,i,l,r,o,s,c,d,p,f,u,g,h,m,b,v,y,w){return function(a,n){function i(){var e=v();return e===!0?getroar():S(),E.resolve(C)}function v(){var e=n.application[0][1],t=new Firebase(w+"content/"+e);t.once("value",function(e){return e.exists()})}function S(){angular.forEach(T,function(e,t){var a=(new Date,angular.copy(e)),n=e.Filename||"00000000-0000-00-00000-NPL.pdf",i=n.slice(0,n.indexOf("-")),l=n.slice(n.indexOf("-")+1,n.indexOf("-")+11),r=n.slice(n.lastIndexOf("-")+1,n.indexOf(".pdf"));a.content_type="document",a.media="https://lexlab.io/files/viewer/web/viewer.html?file=%2Ffiles/public/documents/uspto/"+i+"/"+i+"-image_file_wrapper/"+n,a.description=e["Document Description"]||null,a.filename=e.Filename||null,a.collections=[],a.Application=i||null,a.date=l||null,a.rid=T.indexOf(e),a.doccode=e["Document Code"]||null,angular.forEach(m,function(e,t){r===e&&(a.styleClass="Applicant")}),angular.forEach(h,function(e,t){r===e&&(a.styleClass="PTO")}),angular.forEach(g,function(e,t){r===e&&(a.styleClass="Interview")}),angular.forEach(u,function(e,t){r===e&&(a.styleClass="NOA")}),angular.forEach(f,function(e,t){r===e&&(a.styleClass="Petition")}),angular.forEach(p,function(e,t){angular.forEach(e,function(e,t){r===t&&(a.name=e,a.title=e)})});var o=new Date,b=o.getTime();a.dashboard={model:{rows:[{columns:[{cid:b+10,styleClass:"col-sm-6",widgets:[{config:{height:"30em",url:a.media||"http://www.google.com"},title:a.title||"title",titleTemplateUrl:"{widgetsPath}/testwidget/src/title.html",type:"iframe",wid:b+100,styleClass:a.styleClass||"btn-dark"}]},{cid:b+1e3,styleClass:"col-sm-6",widgets:[{config:{draftid:"PROMISE"},title:a.title||"title",titleTemplateUrl:"{widgetsPath}/testwidget/src/title.html",type:"testwidget",wid:b+1010,styleClass:a.styleClass||"btn-dark"}]}]}],structure:"ROAR-DEFAULT",title:a.title||"PROMISE",titleTemplateUrl:"../src/templates/dashboard-title.html"}},x.$add(a).then(function(e){var t=e.key();console.log("added record with id "+t),e.update({id:t,timestamp:Firebase.ServerValue.TIMESTAMP}),e.child("dashboard").child("model").child("rows").child("0").child("columns").child("1").child("widgets").child("0").child("config").child("draftid").set(t),A.filelist.push(t),C.roarevents.push(t),angular.forEach(d,function(e,n){a.doccode===e&&(A.meritslist.push(t),y.info("merits",t))}),angular.forEach(s,function(e,n){a.doccode===e&&(A.ownlist.push(t),y.info("merits",t))}),angular.forEach(c,function(e,n){a.doccode===e&&(A.artlist.push(t),y.info("merits",t))}),alertify.log("added record with id "+t)})}),o(function(){D(A)},5e3)}function D(t){var a={name:"USSN "+n.application[0][1],title:"USSN "+n.application[0][1],rid:"PHD1 - ALL",collectiontype:"source",box:"PhD for USSN "+n.application[0][1],styleClass:"success",app:n.application[0][1],content_type:"collection",roarlist:t.filelist},i={name:"USSN "+n.application[0][1],title:"USSN "+n.application[0][1],rid:"PHD2 - MERITS",collectiontype:"source",box:"PhD for USSN "+n.application[0][1],styleClass:"danger",app:n.application[0][1],content_type:"collection",roarlist:t.meritslist},l={name:"USSN "+n.application[0][1],title:"USSN "+n.application[0][1],rid:"PHD3 - ART",collectiontype:"source",box:"PhD for USSN "+n.application[0][1],styleClass:"warning",app:n.application[0][1],content_type:"collection",roarlist:t.artlist},o={name:"USSN "+n.application[0][1],title:"USSN "+n.application[0][1],rid:"PHD4 - OWNERSHIP",collectiontype:"source",box:"PhD for USSN "+n.application[0][1],styleClass:"primary",app:n.application[0][1],content_type:"collection",roarlist:t.ownlist},s=[a,i,l,o];angular.forEach(s,function(t,a){x.$add(t).then(function(t){var a=t.key();t.update({id:a,timestamp:Firebase.ServerValue.TIMESTAMP,matter:e.matterId||r.stateParams.matterId,project:e.pId||r.stateParams.pId}),angular.isUndefined(P.collectionlist)?(P.collectionlist=new Array,P.collectionlist.push(a),P.$save()):(P.collectionlist.push(a),P.$save()),C.collections.push(a)})})}var C={collections:new Array,roarevents:new Array},E=b.defer(),P=t(e.matterId,e.groupId),x=l(),T=n.imagefile,A={filelist:new Array,meritslist:new Array,artlist:new Array,ownlist:new Array};return i(),E.promise}}]),angular.module("llp.pdf",["LocalStorageModule"]).config(["localStorageServiceProvider",function(e){e.setPrefix("adf.getphd")}]).factory("pdfToPlainText",["$q",function(e){function t(t){var n=e.defer();PDFJS.disableWorker=!1,console.log(t);var i=PDFJS.getDocument(t.data);return i.then(a),n.promise}return function(e){t(e)};var a}]).directive("getpdftext",["extract","$document","$window","$rootScope",function(e,t,a,n){var i=function(e,t,a,n){e.pdfToPlainText=function(t){var a={title:"pdfData",content:'<div id="pdf"></div>'};e.phd.documents.push(a),PDFJS.disableWorker=!1,$("#pdf").children().remove();var n=PDFJS.getDocument(t);n.then(i)};var i=function(e){for(var t=0;t<e.numPages;t++)e.getPage(t+1).then(r)},l="</section><section class='page card card-fancy'>",r=function(t){var a=angular.element(l).appendTo("#pdf");t.getTextContent().then(function(t){console.log(t),angular.forEach(t,function(t,n){var i="";angular.forEach(t,function(e,t){return i+=e.str}),$(a).append(i),e.pages.push(i)})})}};return{restrict:"A",controller:"PDFFilesController",controllerAs:"pdff",bindToController:!0,link:i}}]).controller("PDFFilesController",["$scope","extract","$document","$window","$http","localStorageService",function(e,t,a,n,i,l){var r=this;r.name="PDFFilesController"}]),angular.module("llp.parsetsv",[]).factory("parseTSV",[function(){return function(e,t,a){var n=e,t=t,i=Papa.parse(n,t);return a?i:i.data}}]),angular.module("adf.widget.getphd").factory("fileReader",["$q","$log",function(e,t){var a=function(e,t,a){return function(){t.resolve(e.result)}},n=function(e,t,a){return function(){t.reject(e.result)}},i=function(e,t){return function(e){}},l=function(e,t){var l=new FileReader;return l.onload=a(l,e,t),l.onerror=n(l,e,t),l.onprogress=i(l,t),l},r=function(t,a){var n=e.defer(),i=l(n,a);return i.readAsDataURL(t),n.promise};return{readAsDataUrl:r}}]),angular.module("llp.extractpdf",[]).factory("extractpdf",["$q",function(e){function t(t,a){var n=a||t.name.slice(0,t.name.indexOf(".")),i=e.defer(),l=new FileReader,r=n,o=r+"/"+r+"-address_and_attorney_agent.tsv",s=r+"/"+r+"-application_data.tsv",c=r+"/"+r+"-continuity_data.tsv",d=r+"/"+r+"-foreign_priority.tsv",p=r+"/"+r+"-transaction_history.tsv",f=r+"/"+r+"-image_file_wrapper/"+r+"-image_file_wrapper.tsv",u=r+"/README.txt",g=[{label:"README",value:u},{label:"attorney",value:o},{label:"application",value:s},{label:"continuity",value:c},{label:"foreign",value:d},{label:"transaction",value:p},{label:"imagefile",value:f}];return l.onerror=i.reject.bind(i),l.onload=function(e){l.result||i.reject(new Error("Unknown error"));var t=new JSZip(l.result,{binary:!0}),a={tsvfiles:new Array,pdffiles:t.files};return angular.forEach(g,function(e,n){var i=t.files[e.value];"undefined"!=typeof i&&a.tsvfiles.push({label:e.label,file:i.asText()})}),i.resolve(a)},l.readAsArrayBuffer(t),i.promise}function a(e,a){return t(e,a)}return a}]),angular.module("llp.extract",[]).factory("extract",["$q",function(e){function t(t,a){var n=a||t.name.slice(0,t.name.indexOf(".")),i=e.defer(),l=new FileReader,r=n,o=r+"/"+r+"-address_and_attorney_agent.tsv",s=r+"/"+r+"-application_data.tsv",c=r+"/"+r+"-continuity_data.tsv",d=r+"/"+r+"-foreign_priority.tsv",p=r+"/"+r+"-transaction_history.tsv",f=r+"/"+r+"-image_file_wrapper/"+r+"-image_file_wrapper.tsv",u=r+"/README.txt",g=[{label:"README",value:u},{label:"attorney",value:o},{label:"application",value:s},{label:"continuity",value:c},{label:"foreign",value:d},{label:"transaction",value:p},{label:"imagefile",value:f}];return l.onerror=i.reject.bind(i),l.onload=function(e){l.result||i.reject(new Error("Unknown error"));var t=new JSZip(l.result,{binary:!0}),a=[];return angular.forEach(g,function(e,n){var i=t.files[e.value];"undefined"!=typeof i&&a.push({label:e.label,file:i.asText()})}),i.resolve(a)},l.readAsArrayBuffer(t),i.promise}function a(e,a){return t(e,a)}return a}]),jQuery.event.props.push("dataTransfer"),angular.module("fa.droppable",[]).directive("dropFiles",[function(){var e=function(e,t,a,n){var i=function(e){for(var t=e.originalEvent.dataTransfer.files,a=[],n=0,i=t.length;i>n;n++)a.push(t[n]);return a},l=function(e){e.preventDefault(),t.css({"border-style":"dotted"})},r=function(e){e.preventDefault(),t.css({"border-style":"dashed"});var a=i(e);n.dropFiles({files:a})};t.on("dragover",l),t.on("drop",r),e.$on("$destroy",function(){t.off("dragover",l),t.off("drop",r)})};return{restrict:"A",controller:"DropFilesController",controllerAs:"drop",bindToController:!0,require:"dropFiles",scope:{accepts:"&",dropFiles:"&",main:"&"},link:e}}]).controller("DropFilesController",["$controller","extract","$scope","$timeout","$rootScope",function(e,t,a,n,i){var l=this;l.file={},l.dropFiles=function(e){console.log("files.files[0]",e.files[0]),a.$parent.main.handleFiles(e)}}])}(window);